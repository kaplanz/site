---
title: Books
---

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const booksEl = document.getElementById("books-container");
    const buttons = document.querySelectorAll("fieldset button");
    const params = new URLSearchParams(window.location.search);
    let currentList = params.get("list") || "read";

    // Update active button
    function updateActiveButton() {
      buttons.forEach(btn => {
        btn.setAttribute("aria-current", btn.id === currentList ? "true" : "false");
      });
    }

    // Render books
    async function loadBooks(list) {
      currentList = list;
      updateActiveButton();

      const books = await fetch(`https://api.zakhary.dev/books/${list}`)
        .then(r => r.json());

      if (list === "read") {
        // Group by year
        const grouped = {};
        books.forEach(item => {
          const year = new Date(item.date).getFullYear();
          grouped[year] = grouped[year] || [];
          grouped[year].push(item);
        });

        booksEl.innerHTML = Object.entries(grouped)
          .sort((a, b) => b[0] - a[0])
          .map(([year, list]) => `
            <details open>
              <summary>
                <h2>${year}</h2>
                <span>(${list.length} books)</span>
              </summary>
              <ul>
                ${list.map(item => `
                  <li class="book">
                    <div class="cover">
                      <img src="${item.book.image?.url || ''}" alt="Cover artwork for ${item.book.title}" title="${item.book.title}"/>
                    </div>
                    <span>
                      <b>${item.book.title}</b> by <em>${item.book.contributions?.map(c => c.author?.name).filter(Boolean).join(", ") || "Unknown"}</em>
                    </span>
                  </li>
                `).join("")}
              </ul>
            </details>
          `).join("");
      } else {
        booksEl.innerHTML = `
          <ul>
            ${books.map(item => `
              <li class="book">
                <div class="cover">
                  <img src="${item.book.image?.url || ''}" alt="Cover artwork for ${item.book.title}" title="${item.book.title}" style="background: ${item.book.image?.color || 'transparent'}"/>
                </div>
                <span>
                  <b>${item.book.title}</b> by <em>${item.book.contributions?.map(c => c.author?.name).filter(Boolean).join(", ") || "Unknown"}</em>
                </span>
              </li>
            `).join("")}
          </ul>
        `;
      }

      // Update URL
      const url = new URL(window.location);
      url.searchParams.set("list", list);
      window.history.replaceState({}, "", url);
    }

    // Button handlers
    buttons.forEach(btn => {
      btn.addEventListener("click", () => loadBooks(btn.id));
    });

    // Initial load
    updateActiveButton();
    loadBooks(currentList);
  });
</script>

<section class="books">
  <header>
    <fieldset>
      <button id="read">Timeline</button>
      <button id="live">Reading</button>
      <button id="next">Backlog</button>
    </fieldset>
  </header>
  <div id="books-container"></div>
</section>

<style>
  .books {
    header {
      padding-block-start: 1em;

      fieldset {
        display: flex;
        flex-wrap: wrap;
        gap: .5em;
        justify-content: center;
        border: none;
        padding: 0;

        button {
          font: 1.2em var(--serif);
          padding: 2px 12px;
          margin: 0;

          &[aria-current="true"] {
            --backgd: color-mix(in srgb, var(--darker) 70%, var(--accent));
            --border: var(--accent);
            --shadow: oklch(from var(--accent) l c h / .4);
          }
        }
      }
    }

    details summary {
      display: flex;
      align-items: center;
      justify-content: space-between;

      > * {
        margin: 0;
      }

      + * {
        margin-block: 1em .5em;
      }
    }

    ul {
      display: grid;
      grid-template-columns: repeat(auto-fill, [col-start] 12ch [col-end]);
      gap: 1em;
      justify-content: center;
      inline-size: 100%;
      margin: 0;
      padding: 0;
      list-style: none;
    }

    li.book {
      display: flex;
      flex-direction: column;

      .cover {
        display: flex;
        align-items: end;
        justify-content: center;
        block-size: 18ch;
        margin-block: .5em;

        img {
          display: block;
          block-size: auto;
          inline-size: auto;
          max-block-size: 100%;
          max-inline-size: 100%;
          object-fit: cover;
        }
      }
    }
  }
</style>
